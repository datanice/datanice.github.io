<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Hassen">
  <meta name="description" content="Posts and writings by Hassen">


<meta name="keywords" content="">

  <title>
    Datanice
&ndash; Sentiment analysis for Youtube channels - with NLTK  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="">
        <img src="/images/datanice_logo.png" alt="logo">
      </a>
      <div class="align-title">
        <h2 class="site-title"><a  href="/">Datanice</a></h2>
        <p>Exploring the world with data</p>
      </div>
      <ul class="base-links">
        <li><a href="/pages/a-propos.html">About</a></li>
        <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
        <li><a href="#" target="_blank">You can add links in your config file</a></li>
        <li><a href="#" target="_blank">Another social link</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="/">Index</a> &brvbar; <a href="/archives.html">Archives</a>
      </p>
    </header>

<article>
  <div class="article_title entry-title">
    <h3><a href="/sentiment-analysis-for-youtube-channels-with-nltk.html">Sentiment analysis for Youtube channels - with NLTK</a></h3>
  </div>
  <div class="article_text">
    <p>In this tutorial, we 'll first take a look at the Youtube API to
retrieve comments data about the channel as well as basic information
about the likes count and view count of the videos. Then, we will use
Nltk to see most frequently used words in the comments and plot some
sentiment graphs.</p>
<p><a href="https://datanice.files.wordpress.com/2015/09/download1-e1441826980693.jpeg"><img alt="download" src="https://datanice.files.wordpress.com/2015/09/download1-e1441826980693.jpeg" /></a><br />
<!--more--></p>
<h1>The Data</h1>
<p>With the script below, we first query the video channels providing the
channel ID then for every video we get a list of comments (Youtube
limits this number to 20 comments per query)</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">DEVELOPER_KEY</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> 
<span class="n">YOUTUBE_API_SERVICE_NAME</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">YOUTUBE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">youtube</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">YOUTUBE_API_SERVICE_NAME</span><span class="p">,</span> <span class="n">YOUTUBE_API_VERSION</span><span class="p">,</span> <span class="n">developerKey</span><span class="o">=</span><span class="n">DEVELOPER_KEY</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_videos_FromChanel</span><span class="p">(</span><span class="n">youtube</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span><span class="n">order</span><span class="p">):</span>
    <span class="n">search_response</span> <span class="o">=</span> <span class="n">youtube</span><span class="o">.</span><span class="n">search</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
        <span class="n">channelId</span><span class="o">=</span><span class="n">channelId</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;video&quot;</span><span class="p">,</span>
        <span class="n">part</span><span class="o">=</span><span class="s2">&quot;id,snippet&quot;</span><span class="p">,</span>
        <span class="n">maxResults</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span>
    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">search_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>

<span class="k">def</span> <span class="nf">get_comment_threads</span><span class="p">(</span><span class="n">youtube</span><span class="p">,</span> <span class="n">videos</span><span class="p">):</span>
    <span class="n">tempComments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">video</span> <span class="ow">in</span> <span class="n">videos</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">video</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">youtube</span><span class="o">.</span><span class="n">commentThreads</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">part</span><span class="o">=</span><span class="s2">&quot;snippet&quot;</span><span class="p">,</span>
            <span class="n">videoId</span><span class="o">=</span><span class="n">video</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">][</span><span class="s2">&quot;videoId&quot;</span><span class="p">],</span>
            <span class="n">textFormat</span><span class="o">=</span><span class="s2">&quot;plainText&quot;</span><span class="p">,</span>
            <span class="n">maxResults</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s1">&#39;relevance&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>


        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;topLevelComment&quot;</span><span class="p">]</span>
            <span class="n">tempComment</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">videoId</span><span class="o">=</span><span class="n">video</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">][</span><span class="s2">&quot;videoId&quot;</span><span class="p">],</span> <span class="n">videoName</span><span class="o">=</span><span class="n">video</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="n">nbrReplies</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;totalReplyCount&quot;</span><span class="p">],</span><span class="n">author</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;authorDisplayName&quot;</span><span class="p">],</span><span class="n">likes</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;likeCount&quot;</span><span class="p">],</span><span class="n">publishedAt</span><span class="o">=</span><span class="n">comment</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;publishedAt&quot;</span><span class="p">],</span><span class="n">text</span> <span class="o">=</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">][</span><span class="s2">&quot;textDisplay&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">tempComments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempComment</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tempComments</span>
</pre></div>


<p>then you can call the function using :</p>
<div class="highlight"><pre><span></span>videos = get_videos_FromChanel(youtube, &quot;CHANNEL_ID&quot;,&quot;viewCount&quot;)
</pre></div>


<h1>Statistics</h1>
<p>Youtube has a special option to retreive the statistic data, we just
have to query the video list method using the "statistic" option.</p>
<div class="highlight"><pre><span></span>def getVideoInfos(videos):
    videoList = {}
    for search_result in videos:
         if search_result[&quot;id&quot;][&quot;kind&quot;] == &quot;youtube#video&quot;:
             videoList[search_result[&quot;id&quot;][&quot;videoId&quot;]] = search_result[&quot;snippet&quot;][&quot;title&quot;]

    s = &#39;,&#39;.join(videoList.keys())
    videos_list_response = youtube.videos().list(id=s,part=&#39;id,statistics&#39;).execute()
    res = []
    for i in videos_list_response[&#39;items&#39;]:
         temp_res = dict(v_title = videoList[i[&#39;id&#39;]])
         temp_res.update(i[&#39;statistics&#39;])
         res.append(temp_res)

    data = pd.DataFrame.from_dict(res)
    data[&#39;viewCount&#39;] = data[&#39;viewCount&#39;].map(lambda x : float(x))
    data[&#39;commentCount&#39;] = data[&#39;commentCount&#39;].map(lambda x : float(x))
    return data

data = getVideoInfos(videos)

infos.sort(&#39;viewCount&#39;,ascending=0).head(20).plot(kind=&#39;bar&#39;, x=&#39;v_title&#39;,y=&#39;viewCount&#39;)
</pre></div>


<p>This is what I get for the view count of the <a href="https://www.youtube.com/channel/UClYb9NpXnRemxYoWbcYANsA">shots of
Awe</a> videos
channel:<br />
<a href="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-175623.png"><img alt="Screenshot from 2015-09-09
17:56:23" src="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-175623.png" /></a></p>
<p>We can have the same plots for likes counts and comments count, and plot
scatter plots to see if there is a correlation between these features.</p>
<p>We can note that the third video has only been uploaded for a few days
at the time I’m writing this article, that's what we call a buzz video.</p>
<p>An interesting chart to plot would be the number of views/time online.</p>
<h1>Comments analysis</h1>
<ul>
<li>
<h3>Word Frequency</h3>
</li>
</ul>
<p>What do people talk about in the comments ? What do they like/hate the
most about the channel ?<br />
In order to answer these questions we can look at the word frequency in
the comments. We can use the "nltk" package to see the distribution :</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.probability</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="nb">all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">&quot;comments.csv&quot;</span><span class="p">)</span>

<span class="n">stop_eng</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
<span class="n">customstopwords</span> <span class="o">=</span><span class="p">[]</span>

<span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tokenizedSentences</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">all</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span><span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="err">  </span> <span class="err"> </span><span class="n">tokenized</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:,.!?&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
<span class="err">  </span> <span class="err"> </span><span class="n">tokens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">tokenizedSentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span>

<span class="n">hashtags</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
<span class="n">ghashtags</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>
<span class="n">mentions</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)]</span>
<span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;www&#39;</span><span class="p">)]</span>
<span class="n">filtered_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stop_eng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">customstopwords</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">hashtags</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ghashtags</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">links</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">mentions</span><span class="p">]</span>

<span class="n">fd</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">(</span><span class="n">filtered_tokens</span><span class="p">)</span>
</pre></div>


<p>FreqDist returns a list of tuples containing each word and the number of
its occurences. Let"s plot a bar chart to visualize it:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span><span class="p">,</span> <span class="n">attrgetter</span>

<span class="n">sortedTuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>And the result :</p>
<p><a href="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-203414.png"><img alt="Screenshot from 2015-09-09
20:34:14" src="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-203414.png" /></a></p>
<p>The most used words are "love" (141 occurrences), "like" (89
occurrences) then "think" and "life". Pretty deep !</p>
<ul>
<li>
<h3>Sentiment Analysis</h3>
</li>
</ul>
<p>In order to analyze the comments sentiments, we are going to train a
Naive Bayes Classifier using a dataset provided by nltk. This could be
imroved using a better training dataset for comments or tweets.</p>
<p>The reviews are classified as "negative" or "positive", and our
classifier will return the probability of each label. We will compute a
score = prob("positive") - prob("negative") to get a score between -1 an
1.</p>
<h4>Training the classifier</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nltk.classify.util</span>
<span class="kn">from</span> <span class="nn">nltk.classify</span> <span class="kn">import</span> <span class="n">NaiveBayesClassifier</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">movie_reviews</span>

<span class="c1">###############</span>
<span class="k">def</span> <span class="nf">word_feats</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
<span class="err">   </span> <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">word</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">])</span>
<span class="c1">###############</span>

<span class="n">negids</span> <span class="o">=</span> <span class="n">movie_reviews</span><span class="o">.</span><span class="n">fileids</span><span class="p">(</span><span class="s1">&#39;neg&#39;</span><span class="p">)</span>
<span class="n">posids</span> <span class="o">=</span> <span class="n">movie_reviews</span><span class="o">.</span><span class="n">fileids</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span>
<span class="err"> </span>
<span class="n">negfeats</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word_feats</span><span class="p">(</span><span class="n">movie_reviews</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="n">fileids</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">])),</span> <span class="s1">&#39;neg&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">negids</span><span class="p">]</span>
<span class="n">posfeats</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word_feats</span><span class="p">(</span><span class="n">movie_reviews</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="n">fileids</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">])),</span> <span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">posids</span><span class="p">]</span>

<span class="n">trainfeats</span> <span class="o">=</span> <span class="n">negfeats</span> <span class="o">+</span> <span class="n">posfeats</span>
<span class="err"> </span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainfeats</span><span class="p">)</span>
<span class="c1">###############</span>

<span class="nb">all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">&quot;comments.csv&quot;</span><span class="p">)</span>

<span class="nb">all</span><span class="p">[</span><span class="s1">&#39;tokenized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:,.!?&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span> <span class="p">)</span>
<span class="nb">all</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">[</span><span class="s1">&#39;tokenized&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">classifier</span><span class="o">.</span><span class="n">prob_classify</span><span class="p">(</span><span class="n">word_feats</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">classifier</span><span class="o">.</span><span class="n">prob_classify</span><span class="p">(</span><span class="n">word_feats</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;neg&#39;</span><span class="p">)</span> <span class="p">)</span>
</pre></div>


<p>Once the classifier trained, we added a column with the sentiment score
using the "classifier.prob_classify" function.</p>
<p>Let's see the results for the first video in a scatter plot (versus
likes)</p>
<div class="highlight"><pre><span></span>videos = all.videoId.unique()
all[all.videoId==videos[1]].plot(kind=&#39;scatter&#39;, x=&#39;sentiment&#39;, y=&#39;likes&#39;, figsize=(12,8))
</pre></div>


<p><a href="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-210331.png"><img alt="Screenshot from 2015-09-09
21:03:31" src="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-210331.png" /></a></p>
<p>For the next one,</p>
<p><a href="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-210427.png"><img alt="Screenshot from 2015-09-09
21:04:27" src="https://datanice.files.wordpress.com/2015/09/screenshot-from-2015-09-09-210427.png" /></a></p>
<p>A cool thing to do here is to see what's the text of every comment. The
best thing to do is to have an interactive plot where hovering on a
point shows the comment text. This could be done with the
<a href="http://d3js.org/">d3.js</a> library. We can also make the axis interactive
and add animations to animate the points when for example changing the
sentiment axis to the publishing date of the comment...</p>
<p>Next Steps:</p>
<ul>
<li>Adding a plot for "number of views"/"time online"</li>
<li>Interactive d3.js plot to see the comment text when hovering on he
    comment.</li>
</ul>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 09 September 2015</p>
    <p>Category: <a href="/category/non-classe.html">Non classé</a>
    </p>
  </div>


</article>


    <div id="ending_message">
      <p>&copy; Hassen. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>